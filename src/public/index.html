<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Omnichat</title>
	<link rel="stylesheet" href="css/style.css">
	<script src="https://cdn.socket.io/4.5.3/socket.io.min.js"></script>
	<style>
		#username-form {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			background-color: var(--inset-color);
			padding: 20px;
			border-radius: 10px;
			box-shadow: 0 0 10px 0 rgba(0, 0, 0, 0.5);
			width: 300px;
			text-align: center;
			font-size: 20px;
			font-family: sans-serif;
			color: var(--text-color);
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			user-select: none;
			cursor: default;
		}

		#username-input {
			width: 100%;
			padding: 10px;
			border: none;
			border-radius: 6px;
			margin: 10px 0;
			font-size: 20px;
			font-family: sans-serif;
			color: black;
			outline: none;
		}

		#username-input:focus {
			box-shadow: 0 0 5px 0 rgba(0, 0, 0, 0.5);
		}

		#username-submit {
			width: 100%;
			padding: 10px;
			border: none;
			border-radius: 6px;
			margin: 10px 0;
			font-size: 20px;
			font-family: sans-serif;
			background-color: var(--yes-color);
			color: var(--text-color);
			outline: none;
			cursor: pointer;
		}

		#username-submit:hover {
			background-color: var(--yes-color);
		}
	</style>
</head>
<body>
	<div id="app-container">
		<div id="main-content" class="distribute-column">
			<div style="text-align: center;">
				<form id="username-form">
					<h1>Welcome to Omnichat!</h1>
					<p>Enter a username to get started:</p>
					<input type="text" id="username-input" placeholder="Username" autocomplete="off">
					<button type="submit" id="username-submit">Let's go</button>
				</form>
				<script defer>
					const username_input = document.getElementById("username-input");
					const username_form = document.getElementById("username-form");

					// Add a submit event listener
					username_form.addEventListener("submit", (e) => {
						e.preventDefault();
						if (username_input.value) {
							// Send username to new_account endpoint
							fetch("/api/new_account", {
								method: "POST",
								headers: {
									"Content-Type": "application/json"
								},
								body: JSON.stringify({
									username: username_input.value
								})
							}).then(async (res) => {
								if (res.status === 200) {
									// Set the resulting user ID as a cookie
									document.cookie = `user_id=${await res.text()}`;
									// Redirect to the chat page
									window.location.href = "/chat.html";
								} else {
									// Show an error message
									let error_message = document.createElement("p");
									error_message.innerText = await res.text();
									error_message.style.color = "red";
									error_message.style.marginTop = "10px";
									username_form.appendChild(error_message);
								}
							});
						}
					});

					// Focus on the username input
					username_input.focus();
				</script>
			</div>
		</div>
	</div>
</body>
</html>