<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Omnichat</title>
	<link rel="stylesheet" href="css/style.css">
</head>
<body>
	<h1>This isn't ready yet!</h1>
	<div id="messages-list">
		<ul id="messages"></ul>
	</div>
	<div id="message-box">
		<form id="message-form" action="">
			<input type="text" id="message-input" autocomplete="off" placeholder="Type your message here">
			<button type="submit">Send</button>
		</form>
	</div>
	<script src="https://cdn.socket.io/4.5.3/socket.io.min.js"></script>
	<script>
		let socket = io();

		const form = document.getElementById("message-form");
		const input = document.getElementById("message-input");
			const messages = document.getElementById("messages");

		form.addEventListener("submit", (e) => {
			e.preventDefault();
			if (input.value) {
				socket.emit("msg_send", {
					message: input.value
				});
				
				input.value = "";
			}
		});

		// TODO: User feedback on connect/disconnect/error
		socket.on("connect", () => {
			console.log("Connected to server.");
		});

		socket.on("disconnect", (reason) => {
			console.log(`Disconnected from server. Reason: ${reason}`);
		});

		socket.on("connect_error", (err) => {
			console.log("Connection error: " + err);
		});


		socket.on("msg_rcv", (data) => {
			let message = document.createElement("li");
			message.textContent = data.message;
			messages.appendChild(message);
			window.scrollTo(0, document.body.scrollHeight);
		});
	</script>
</body>
</html>